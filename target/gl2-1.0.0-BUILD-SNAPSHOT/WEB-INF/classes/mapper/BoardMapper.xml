<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.ezen.gl.mapper.BoardMapper">
	<!-- 전체 게시글 수 -->
	<select id="totalCnt" resultType="Integer">
		SELECT count(*) FROM tbl_board
		<include refid="criteria"></include>

	</select>
	
	<!-- 게시글 등록 -->
	<insert id="insert" parameterType="boardDTO">
		INSERT INTO tbl_board(subject, contents, writer)
		VALUES(#{subject},#{contents},#{writer}) 
	</insert>
	<sql id="criteria">
		<!-- 'S' 문자열 변환이 없으면 문자형(ascii)숫자로 인식
			NumberFormat 예외발생, toString()
		-->
		<if test="searchType == 'S'.toString()">
			WHERE subject LIKE CONCAT('%', #{keyWord}, '%')
		</if>
		<if test='searchType == "C"'>
			WHERE contents LIKE CONCAT('%', #{keyWord}, '%')
		</if>
		<if test="searchType == 'W'.toString()">
			WHERE writer LIKE CONCAT('%', #{keyWord}, '%')
		</if>
		<if test='searchType == "SC"'>
			WHERE subject LIKE CONCAT('%', #{keyWord}, '%')
				OR contents LIKE CONCAT('%', #{keyWord}, '%')
		</if>
		<if test='searchType == "SW"'>
			WHERE subject LIKE CONCAT('%', #{keyWord}, '%')
			OR writer LIKE CONCAT('%', #{keyWord}, '%')
		</if>
		<if test='searchType == "SCW"'>
			WHERE subject LIKE CONCAT('%', #{keyWord}, '%')
			OR contents LIKE CONCAT('%', #{keyWord}, '%')
			OR writer LIKE CONCAT('%', #{keyWord}, '%')
		</if>
	</sql>


	<!-- 게시글 리스트 -->
  	<select id="getList" resultType="boardDTO">
   		SELECT * FROM tbl_board
<!--   		SELECT * FROM tbl_board LIMIT 0, 10 -->
<!--  		SELECT * FROM tbl_board-->
		<include refid="criteria"></include>
		ORDER BY bid DESC LIMIT #{startIndex}, #{cntPerPage}
  	</select>
  	<!-- 글 상세보기 -->
  	<select id="view" parameterType="Integer" resultType="boardDTO">
  		SELECT * FROM tbl_board WHERE bid=#{bid}
  	</select>
  	
  	<!-- 수정하기 -->
  	<update id="update" parameterType="boardDTO">
  		UPDATE tbl_board SET subject=#{subject}, contents=#{contents}
  		WHERE bid=#{bid}
  	</update>
  	
  	<delete id="delete" parameterType="Integer">
  		DELETE FROM tbl_board WHERE bid = #{bid}
  	</delete>
  	
  	<update id="hitAdd" parameterType="Integer">
  		UPDATE tbl_board SET hit = hit+1 WHERE bid=#{bid}
  	</update>

	<!--   <select id="memberList" resultType="model.MemberDTO"> -->
	<select id="memberList" resultType="memberDTO">
		select * from member
	</select>

	<insert id="memberInsert" parameterType="memberDTO">
		INSERT INTO member(id, pw, name ,age, email, tel,
		zipcode, road_addr, jibun_addr, detail_addr)

		VALUES(#{id}, #{pw},#{name},#{age},#{email},#{tel},
		#{zipcode},#{road_addr},#{jibun_addr},#{detail_addr})
	</insert>

	<delete id="deleteMember" parameterType="Integer">
		DELETE FROM member WHERE no = #{no}
	</delete>

	<select id="memberInfo" parameterType="Integer" resultType="memberDTO">
		SELECT * FROM member WHERE no = #{no}
	</select>

	<update id="memberUpdate" parameterType="memberDTO">
		UPDATE member SET age=#{age}, email=#{email},
		tel=#{tel} WHERE no = #{no}
	</update>

	<select id="idCheck" resultType="memberDTO">
		SELECT * FROM member WHERE id = #{uid}
	</select>
  	
</mapper>